{% load django_glue %}

<div x-data="{
        value: null
    }"
        {% if glue_model_field %}
            x-modelable="value"
            x-model="{{ glue_model_field }}"
        {% endif %}
>
    <div
        x-data="{
            init() {
                    let glue_model_field_name = '{{ glue_model_field }}'
                    if (glue_model_field_name) {
                        let path = glue_model_field_name.split('.')
                        this.glue_field = this[`${path[0]}`]['_meta'][`${path[1]}`]['_meta']['glue_field']
                        this.bind_glue(this.glue_field)
                    }

                    this.$watch('glue_field', value => {
                        // Have to construct the object here because fo how alpine serializes that objects.
                        console.log('binding')
                        // let glue_field = construct_glue_form_field(value)
                        this.bind_glue(this.glue_field)
                    })
            },
            glue_field: undefined,
            bind_glue(glue_field) {
                let glue_form_field_binder = glue_binder_factory(glue_field, this.$refs.glue_field)
                glue_form_field_binder.bind()
            },
        }"
        {% if glue_field %}
{#            x-modelable="glue_field"#}
{#            x-model="{{ glue_field }}"#}
        {% endif %}
                 
    >
        {% block field_label %}
            <label
                x-ref="label"
                class=""
                for="{% if name %}id_{{ name }}{% elif label %}id_{% to_snake_case label %}{% endif %}"
            >
                {{ label }}{% if required %}*{% endif %}
            </label>
        {% endblock %}
        {% block field_content %}
        {% endblock %}
    </div>
</div>