<script type="application/javascript">

    function glue_connect(element, value) {
        element.value = value
        console.log(value)
    }

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    const csrf_token = getCookie('csrftoken');

    function post_ajax(url, data) {
        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrf_token,
            },
            body: JSON.stringify(data),
        })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data)
            })
            .catch((error) => {
                console.error('Error:', error)
            });
    }

    const javascript_output = document.getElementById('javascript-output')
    let glue = JSON.parse('{{ glue_json_string|safe }}')
    let proxy_glue = JSON.parse('{{ glue_json_string|safe }}')

    let glue_change_interval = setInterval(function () {
        if (JSON.stringify(glue) !== JSON.stringify(proxy_glue)) {
            post_ajax(
                '{% url 'django_glue:glue_handler' %}',
                {
                    'something': 'tacos',
                    'another': 123,
                },
            )
            proxy_glue = JSON.parse(JSON.stringify(glue))
            javascript_output.innerText = JSON.stringify(glue)
        }
    }, 2000);

    console.log(glue)

    javascript_output.innerText = JSON.stringify(glue)

</script>